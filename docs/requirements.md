# 要件定義

## アプリの目的

### 解決したい課題
- 小学生のスマホ時間がYouTube視聴に偏りがちで、保護者に罪悪感がある
- 紙の計算ドリルでは続かず楽しめない
- 先生が推薦できる、保護者が安心して与えられるアプリが少ない

### 期待される効果
- 計算力を楽しく伸ばせる
- スマホ時間が「無駄」ではなく「学び」になる
- 保護者や先生が安心して子どもに勧められる

## 👥 想定ユーザー

### プライマリユーザー
- 小学生（1〜6年生）

### セカンダリユーザー
- 保護者（YouTube代替として）
- 小学校の先生（授業外の補助教材として）

### ユーザーの行動パターン
- 子どもは隙間時間にゲーム感覚で問題を解く
- 保護者は履歴を時々確認
- 先生は児童におすすめする

## ユースケース

### 基本フロー

| シナリオ                | 説明                                     | 頻度 |
|-------------------------|----------------------------------------|------|
| 計算カテゴリを選択する   | やりたい計算の種類を選ぶ | 毎回 |
| ゲームモードを選択する   | タイムアタック / エンドレスを選ぶ              | 毎回 |
| 問題を解いてスコアを出す | 制限時間内や間違えるまで問題を解く                    | 毎回 |
| 保護者が履歴を確認する   | 正答率や回数を保護者が確認する                        | 時々 |

### 詳細ユースケース
- 兄弟や友達と対戦モードで勝負
- 毎日1問だけデイリーチャレンジ（将来的に）
- 繰り返しで正答率アップを目指す

---

## 対応プラットフォーム

### 初期リリース
- **Android**: Android 8.0（API 26）以上
- **iOS**: iOS 14.0 以上
- **デバイス**: スマホのみ（タブレットは非対応）

### 技術制約
- 完全オフラインで動作
- データは端末内SQLite保存
- ログイン認証なし

## 機能要件（初期バージョン）

### データ管理

#### プレイヤー情報管理
- [ ] 匿名プレイヤー名登録
- [ ] スコア履歴SQLite保存
- [ ] ログイン不要

#### 計算問題管理
- [x] カテゴリ選択（繰り上がり・繰り下がりあり/なし）
- [x] 難易度別問題生成
- [x] ユーティリティ化して単体テスト可能
- [x] 足し算・引き算・掛け算・割り算対応
- [x] 1桁〜2桁の演算対応
- [x] 繰り上がり/繰り下がりありなしの制御
- [x] 割り算は割り切れる問題のみ生成

#### 状態管理
- [x] Providerで状態管理
- [x] 選択中カテゴリ・モードの保持
- [x] 正答数・残り時間のリアクティブ更新

### ゲームモード

- [x] タイムアタック
- [x] 間違えるまでのエンドレス
- [ ] フレンド対戦（ローカル）
- [ ] デイリーチャレンジ（将来的）

### ゲームプレイ機能

#### GamePlayScreen
- [x] 問題テキストが大きく中央に表示される
- [x] 数字入力用のUI（NumberPad）
- [x] 送信ボタンで正答判定ができる
- [x] 正解時に次の問題へ切り替わる
- [x] 正答数カウントがリアルタイムで表示される
- [x] 残り時間のカウントダウンが表示される（タイムアタック用）
- [x] 正解時にアニメーション（Scaleや色変更など）
- [x] Providerで状態管理
- [x] 問題ジェネレーターと連携する

#### UI/UX要件
- [x] Material Design 3に準拠
- [x] タッチターゲットは48dp以上
- [x] フォントサイズは大きめ
- [x] 子どもが迷わずスムーズに操作できるシンプルなUI
- [x] 正解時のフィードバックでモチベーションを高める

#### 技術要件
- [x] 拡張しやすい構造（将来的に音声読み上げ機能追加の可能性）
- [x] 効果音ON/OFFは別Issueで管理
- [x] 単体テスト・ウィジェットテストの追加
- [x] `flutter analyze`で警告が出ないことを確認

## 非対応（初期）

- ランキング機能
- Firebase連携
- オンライン対戦
- 認証/SNS連携
- クラウド保存
- 広告表示

## 非機能要件

### パフォーマンス
- 画面遷移1秒以内
- 問題生成は即時

### 可用性
- 完全オフラインで使用可
- 子ども一人でも直感操作可能

### セキュリティ
- 個人情報は端末内のみ保存
- 外部通信なし

### 保守性
- ロジックをユーティリティ化
- テストカバレッジ80%以上

## 成功指標

### 定量
- 1回の平均利用時間5分以上
- 週3回以上継続利用

### 定性
- 保護者の罪悪感軽減の声
- 学校で先生が推薦してくれる

## 将来的に検討する機能
- ごほうびアバター
- デイリーチャレンジ
- クラス単位ランキング
- 学習進捗レポート
- オンライン対戦

## 実装済み機能

### 計算問題生成システム
- **MathProblem モデル**: 計算問題のデータ構造
- **MathProblemGenerator ユーティリティ**: 問題生成ロジック
- **難易度レベル**: easy, medium, hard
- **対応カテゴリ**: 足し算、引き算、掛け算、割り算
- **単体テスト**: モデルとジェネレーターの完全テスト
- **特徴**:
  - 繰り上がり/繰り下がりありなしの制御
  - 1桁〜2桁の演算対応
  - 割り算は割り切れる問題のみ
  - 選択肢生成機能
  - ランダム問題生成機能

### ゲームプレイシステム
- **GameProvider**: ゲーム状態管理（Provider）
- **GamePlayScreen**: メインゲーム画面
- **GameHeader**: スコア・時間表示ウィジェット
- **ProblemDisplay**: 問題表示ウィジェット
- **NumberPad**: 数字入力パッドウィジェット
- **ゲームモード**: タイムアタック・エンドレス
- **アニメーション**: 正解時のスケール・色変更アニメーション
- **単体テスト**: Providerとウィジェットのテスト
- **特徴**:
  - Material Design 3準拠のUI
  - リアルタイムスコア表示
  - カウントダウンタイマー（タイムアタック）
  - 直感的な数字入力UI
  - 正解・不正解の視覚的フィードバック
